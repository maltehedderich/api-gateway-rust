# Example configuration for API Gateway
# This is a reference configuration showing all available options

server:
  # Address to bind the server to
  bind_address: "0.0.0.0"

  # Port to listen on
  port: 8443

  # TLS configuration (optional - if not provided, runs in HTTP mode)
  # tls:
  #   cert_path: "/path/to/cert.pem"
  #   key_path: "/path/to/key.pem"
  #   min_version: "1.2"  # or "1.3"

  # Connection timeout in seconds
  connection_timeout_secs: 60

  # Maximum concurrent connections
  max_connections: 10000

  # Request timeout in seconds
  request_timeout_secs: 30

# Upstream services configuration
upstreams:
  # Example upstream service
  - id: "user-service"
    base_url: "http://localhost:8081"
    timeout_secs: 30
    pool_max_idle_per_host: 10
    health_check_path: "/health"

  - id: "product-service"
    base_url: "http://localhost:8082"
    timeout_secs: 30
    pool_max_idle_per_host: 10

  - id: "order-service"
    base_url: "http://localhost:8083"
    timeout_secs: 30
    pool_max_idle_per_host: 10

# Routes configuration
routes:
  # Exact match example
  - id: "get-users"
    methods: ["GET"]
    path: "/api/users"
    upstream_id: "user-service"

  # Path parameter example
  - id: "get-user-by-id"
    methods: ["GET"]
    path: "/api/users/{id}"
    upstream_id: "user-service"

  # Multiple methods example
  - id: "users-crud"
    methods: ["POST", "PUT", "DELETE"]
    path: "/api/users/{id}"
    upstream_id: "user-service"

  # Prefix match example (all requests starting with /api/products/)
  - id: "product-api"
    methods: ["GET", "POST", "PUT", "DELETE"]
    path: "/api/products/*"
    upstream_id: "product-service"

  # Strip prefix example (removes /api/v1 before forwarding)
  - id: "orders-v1"
    methods: ["GET", "POST"]
    path: "/api/v1/orders/*"
    upstream_id: "order-service"
    strip_prefix: "/api/v1"

  # Custom upstream path example
  - id: "legacy-orders"
    methods: ["GET"]
    path: "/legacy/orders"
    upstream_id: "order-service"
    upstream_path: "/api/orders"

  # Custom timeout example
  - id: "slow-operation"
    methods: ["POST"]
    path: "/api/reports/generate"
    upstream_id: "product-service"
    timeout_secs: 120

  # Protected route requiring authentication
  - id: "protected-users"
    methods: ["GET", "POST", "PUT", "DELETE"]
    path: "/api/admin/users/*"
    upstream_id: "user-service"
    auth_required: true
    required_roles: ["admin"]  # RBAC: User must have 'admin' role

  # Route requiring specific permissions
  - id: "create-order"
    methods: ["POST"]
    path: "/api/orders"
    upstream_id: "order-service"
    auth_required: true
    required_permissions: ["orders:create"]  # PBAC: User must have this permission

  # Route requiring multiple permissions
  - id: "manage-products"
    methods: ["PUT", "DELETE"]
    path: "/api/products/{id}"
    upstream_id: "product-service"
    auth_required: true
    required_permissions: ["products:write", "products:delete"]

# Authentication configuration (optional - if not provided, authentication is disabled)
# NOTE: For production, load secrets from environment variables instead of config file
auth:
  # JWT algorithm for token validation (HS256, RS256, or ES256)
  jwt_algorithm: "HS256"

  # JWT secret key for HS256 algorithm (symmetric)
  # For production, use environment variable: GATEWAY_JWT_SECRET
  # jwt_secret: "your-secret-key-here-min-256-bits"

  # JWT public key for RS256/ES256 algorithms (asymmetric)
  # For production, use environment variable: GATEWAY_JWT_PUBLIC_KEY
  # jwt_public_key: |
  #   -----BEGIN PUBLIC KEY-----
  #   MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
  #   -----END PUBLIC KEY-----

  # Cookie name for session token (default: session_token)
  cookie_name: "session_token"

  # JWT issuer claim validation (optional - validates 'iss' claim)
  # jwt_issuer: "https://auth.example.com"

  # JWT audience claim validation (optional - validates 'aud' claim)
  # jwt_audience: "api-gateway"
